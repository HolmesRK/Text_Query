# Text Query

仿照《C++ primer》P432 的文本查询程序，使用cmake构建的练习小项目，以后会基于此项目进行拓展。

> 测试文本使用ChatGPT生成。

## 功能

查询输入单词在文件中出现的次数以及出现的位置（行），并输出所在行的内容。

## 用法

`main`中指定txt文件路径，运行后输入单词进行查询，输入 q 退出查询。

---

## 更新日志

### 2023/03/31

由于系统更新，重新配置了ubuntu支持的clang版本，并重新配置lldb，在过程中发现若干问题：

- debug过程中，lldb的工作路径需要与cmake生成的**可执行文件**路径保持一致（**与源代码文件无关**），否则无法处理程序中出现的**相对路径**，方法是在`launch.json`文件中修改`cwd`选项：

    ```json
    "cwd": "${workspaceFolder}/bin"
    ```

- `launch.json`中的可执行文件指代符失效，原因不明，暂时直接使用可执行文件路径：

    ```json
    "program": "${workspaceFolder}/bin/TextQuery"
    ```

### 2023/03/28

- 更改了项目结构，将`main`文件放在根目录下，库文件统一放在`src`文件夹下，能够独立编译动态链接库，便于主函数调用。
- 尝试使用python的ctypes调用`.so`链接库，在传递字符串参数时遇到问题，之后参考文章
  [Python调用C的基础学习（传递数字、字符串、数组（一维、二维）、结构体）](https://blog.csdn.net/qq_31342997/article/details/88374804)
  解决了问题。

#### 总结

  1. 在C++模块中，在要调用的函数前添加`extern "C"`，指定为C语言编译风格；
  2. 参数传递需要遵循c语言风格，传递字符串时形参类型应为`char *`；
  3. 要生成`.so`动态链接库，需要在src/CMakeLists.txt文件中指定`add_library`为`SHARED`；
  4. python传递的字符串参数需要设置为`utf-8`编码，原因是python的字符串中**每个字符占2位**，而英文字母仅占1位，后1位由`\0`填充，而c语言风格字符串的结尾符也是`\0`，因此会出现传参时仅能传入第一个字符，更详细的说明参考上面的文章。
